# TCP와 UDP

지금껏 소켓을 쓰면서 지나친 TCP와 UDP에 대해 알아볼 차례다.  
그전에 잠깐 네트워크 통신에 대해 개괄적으로 살펴보자. 엄청 궁금하면  
네트워크: 하향식 접근을 읽어보자.

## TCP/IP 모델

![통신 계층 모델](https://i.namu.wiki/i/ckNxYfrAD8VnMC8XYMWnkhbbQAnQOfz2c7cXBmxVWzTELZIVugenCG_oQFDvoFntIWvIRwAvQM_tUcFKTXgoM6eP6N7Zj9Wdw_dGQNZp3Ajcp-Fl9Qi9oWMZBpq52L43EpB3QixhH22zHFk2cKzk6w.webp)

TCP/IP는 인터넷 통신에 쓰이는 통신 프로토콜들의 집합을 구성하는 프레임워크이다.  
TCP/IP의 특징으로는 각 계층을 추상화하여 다른 프로토콜을 갈아 끼울 수 있다는 것이다.

- 프로토콜이란? 규약이다. 어떻게 데이터를 주고 받을지 합의가 있어야 통신이 가능할 것이다.

응용 - 전송 - 네트워크 - 링크 -물리 5개로 나뉜다.  
게임제작을 위해서 상위 계층을 다루겠지만 최적화를 위해서 하위 계층에 대해 알아두면 좋다.

### 물리 계층

가장 기본적인 하드웨어 전송을 지원하는 계층. 일단 물리적 연결이 있어야 정보를 주고 받을  
수 있다. CAT-6 케이블, 전화선, 동축 케이블, 광섬유, 전파가 연결에 이용된다.

### 링크 계층

물리계층과 밀접한지라 둘이 하나로 취급되는 경우도 있다.  
링크 계층의 역할은 송수신자가 물리계층을 통해 정보를 교환하는 수단을 제공하는 것이다.

- 식별 수단으로서 특정 목적지에 주소를 부여해서 각 프레임에 기재
- 링크 계층 송수신 단위인 Frame 포맷 정의
- 윗단 계층에서 알 수 있게 프레임의 최대 길이를 정의
- 물리적 신호와 프레임 사이의 변환 정의

전기적 간섭이나 장비고장 등 물리적 매체에 이상이 있으면 전송에 이상이 있을 수 있다.  
이 계층에서는 전송 보장을 하지않는다. 고로 상위계층에서 보장이 되도록 알고리즘을 설계  
해야한다.

물리매체마다 대응되는 하나 이상의 프로토콜이 존재한다.

랜선 - 이더넷 10BASE-T, 이더넷 100BASE-T, 이더넷 1000BASE-T  
2.4GHz전파 - 802.1b, 802.11g, 80211n  
구리선 - 구리선 이더넷 통신  
5GHz전파 - 802.11n, 802.11ac  
85MHz전파 -3G, 4G  
광케이블 - 이더넷 10G BASE-SR, 이더넷 10G BASE-LR  
동축 케이블 -동축 이더넷

TCP/IP 스택이 추상화가 잘 되어 있어서 링크계층까지 게임 시스템이 파악할 필요는 없다.  
허나 살다보면 무조건 마주치는 게 하나 있는 데 이더넷 프로토콜이다.

#### 이더넷/802.3

정확히 말하자면 프로토콜 중 하나가 아니라 이더넷 블루북에 근거한 프로토콜 그룹이라 해야  
맞다. 각 매체마다 상응하는 이더넷 파생 프로토콜이 있다. 오늘날 이더넷 프로토콜은 IEEE  
 802.3 표준으로 정의하고 있다.

여러 호스트 식별을 위해 이더넷에선 매체 접근 주소, MAC주소를 사용한다. 이 값은 이론상 고유한  
48비트 값이며 이더넷 네트워크에 연결 가능한 장비 하나하나 마다 고유하게 부여된다. 이러한 장비를  
네트워크 인터페이스 컨트롤러 NIC라고 한다. 예전에는 확장카드로 취급했지만 요새는 메인보드에 내장  
된다. NIC확장카드를 더 사용해서 여러 MAC주소를 가질 수도 있다.

이더넷만 MAC주소를 쓰는 건 아니고 WIFI나 블르투스등 대부분이 링크 계층 프로토콜이 MAC주소를 쓴 다.

### 네트워크 계층

링크계층만으로 통신하는 데 충분한 것 같은데 이게 왜 있나 싶을 것이다. 다음과 같은
상황을 고려해보자.

- MAC주소로 웹서버를 접속하는 데 사용자가 일일이 기억하기도 힘들 뿐더러 NIC를 바꾸면 주소도 바뀌어서  
  접속 못한다.
- 링크계층만으론 인터넷을 작은 네트워크 망으로 나눌 수 없다. 링크계층만으로 구성된다면 모두가 연결되어  
  있어야한다. 이더넷에선 각 프레임을 모든 호스트에 전달 해야한다. 비용과 보안문제가 있다.
- 링크계층에서는 한 종류의 링크 프로토콜을 다른 것으로 바꾸는 방법이 정의되어 있지 않다.

네트워크 계층의 역할은 링크 계층 위에 논리 주소 체계를 구축 하는 것이다. 이를 통해 언급한 문제들을 해결  
할 수 있다.

데이터는 Packet이라는 포맷으로 정의된다.

#### IPv4

가장 많이 쓰이는 프로토콜 중하나다. 각 호스트마다 개별 적인 주소(32bit)를 부여하고, 서브넷 체계로 주소  
공간의 논리적 부분 집합을 나누어 물리적 서브네트워크를 정의하는 데 사용한다. 또 라우팅 체계로 서브넷 사이  
에 데이터를 전달한다.

### 전송 계층

네트워크 계층 역할이 네트워크상 멀리 떨어진 호스트 사이에 통신을 촉진한다면, 전송 계층은 호스트상의 각 프로  
세스 사이의 통신을 가능케 하는 것이다. 호스트 하나에 프로세스가 하나만 도는 게 아니라서 IP패킷을 받더라도  
어디로 넘길지 모른다. 이를 위해 16비트의 Port번호가 도입된다. 해당 포트에 바인딩 된 프로세스로 데이터가 넘겨  
진다. UDP와 TCP가 있다.

### 응용 계층

우리가 게임코드를 작성하는 이곳이 바로 응용계층이다. 종단간 통신에 필요한 여러 인터넷 프로토콜들이 이곳에 위치  
하여 전송 계층과 상호 작용한다. DHCP, DNS, HTTP, SSL등이 대표적이다.

## TCP vs UDP

SOCK_STREAM, SOCK_DGRAM 타입으로 소켓 생성시 각각 지정가능하다.  
TCP는 연결지향이며(1:1), 전송 순서가 보장 되며, 경계의 개념이 없다.  
UDP는 연결 개념이 없고, 전송 순서가 보장이 안되며, 경계의 개념이 있다.

TCP는 전송 오류시 책임지고 다시 전송한다. 혼잡상태를 고려하며, 느리다.  
UDP는 전송 오류시 칙임을 안진다. 일단 보내고 봐서, 빠르다.
