# 언리얼 패키징

하나의 프로세스로 클라이언트를 2개 openLevel은 불가능하고 그렇다고 에디터까지켜고 클라까지 2개켜면  
렉이 조금있어서 이참에 패키징을 해서 정상적인 속도로 작업을 하고 싶어졌다. ~~허나 나의 잘못된 레플리  
케이션 코드가 원인이였다... 좋은 공부 했잖아 그래도?~~

언리얼 프로젝트가 배포되기전에 적절히 패키징 되어야만한다. 패키징은 모든 코드와 컨텐츠가 최신상태이고 타겟 플랫폼에서 적절한  
포맷으로 도는 것을 보장한다. 패키징과정에서 여러 작업들이 수행된다. 프로젝트 특정적인 소스코드가 먼저 컴파일 된다. 컴파일이  
되고나면 모든 컨텐츠가 타겟 플랫폼에서 사용가능한 포맷으로 변환(또는 쿠킹)된다. 그 후 컴파일된 코드와 쿠킹된 컨텐츠가 인스톨러  
같은, 배포가능한 파일 집합으로 묶음 된다.

## 게임 디폴트 맵 설정

패키징 전에 패키징된 게임이 시작할 때 로딩 될 Game Default Map을 설정해야한다. 이걸 설정 안하면 실행해도 검은 화면만 나온다고 한다.  
Edit > ProjectSettings >Maps & Modes 로 설정 가능하다. 나는 에디터에서 작업할때 그냥 같이 설정 해놨었는 지 할 필요는 없었다.

## 고급 설정

Edit > Project Settings > Packaging에서 고급 패키징 설정도 제공한다.

- Build Configuration : 무조건 Shipping 인줄 알았지만 프로젝트 빌드할떄 본 DebugGame, Development또한 제공한다. Shipping을 했다가  
  크래시 발생시 로그가 안나오는 데 로그를 통한 패키징 결과물을 디버깅하려면 다른 설정을 써야한다.
- Full Rebuild : 이름 그대로다. false이면 바뀐 부분만 빌드한다. 처음 패키징할떄는 5시간 걸렸지만 코드 변경후 다시하면 5~30분 정도만 걸린다. 이유는 모르겠지만 최종 결과물에는 true가 권장된다.

- Use Pak File : 기본값으로 false로 되어있다. true이면 모든 컨텐츠파일이 개별 파일이 아닌 하나의 .pak 파일로 들어간다. 애셋이 많다면
  true로 하는 게 배포가 편해진다.

## 쿠킹

언리얼은 내부적으로 컨텐츠 애셋들을 특정 포맷으로(텍스쳐는 PNG, 오디오는 WAV로)저장한다. 허나 다수의 플랫폼이 서로 다른 포맷을  
사용한다. 고로 내부 포맷을 플랫폼 특정적 포맷을 변환해야 하는 데 이를 쿠킹이라 한다.

새로운, 또는 수정된 컨텐츠가 있을 떄마다 다시 패키징 다하는 건 피하고 싶을 것이다. 그래서 오로지 타겟 플랫폼에 대해 패키징 없이  
쿠킹만 하는 것도 가능하다.

## 패키지 내에서의 BP를 로딩 에러

```c++
static ConstructorHelpers::FObjectFinder<UAnimBlueprint> wizardAnimBP
(TEXT("/ Script / Engine.AnimBlueprint'/Game/BattleWizardPolyart/Animations/WizardAnImBP.WizardAnImBP'"));
m_pSkeletalMeshComponent->SetAnimInstanceClass(wizardAnimBP.Object->GeneratedClass);
```

아무리해도 블루프린트를 찾지못한다. 반면에 같은 FObjectFinder라도 스켈레탈 메시같은건 잘 만된다. 포럼에서 언급된 바에
따르면 에디터 밖에서 UBlueprints와 그 하위 클래스들은 로드 불가능하다고 한다. 대신에 이들의 generated 클래스가 패키징  
된 게임에 쓰여야한다. 대신 한 유저가 꼼수로 Class로 불러와서 하는 방법을 썼는 데, 나도 ClassFinder로 찾아와서 설정  
했다. 참고로 스켈레탈 메시 컴포넌트에 애님 클래스 설정시 엔진에서 알아서 개체 생성까지 해준다.

#### 참조

- [언리얼 공식문서 : Packaging Unreal Engine Projects](https://dev.epicgames.com/documentation/en-us/unreal-engine/packaging-unreal-engine-projects)
- [Why can’t i dynamically load an animation BP in a packaged game?](https://forums.unrealengine.com/t/why-cant-i-dynamically-load-an-animation-bp-in-a-packaged-game/326615/3)
- [언리얼 공식문서 : Content Cooking](https://dev.epicgames.com/documentation/en-us/unreal-engine/cooking-content-in-unreal-engine)
- [언리얼 공식문서 : Build Operations: Cook, Package, Deploy, and Run](https://dev.epicgames.com/documentation/en-us/unreal-engine/build-operations-cooking-packaging-deploying-and-running-projects-in-unreal-engine)
